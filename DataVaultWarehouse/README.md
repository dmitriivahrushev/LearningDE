# AnalyticalDatabases
![avtar](./images/dv_model.jpg)
## –û –ø—Ä–æ–µ–∫—Ç–µ
–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å—Ö–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –°–£–ë–î Vertica –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–µ–π Data Vault, –∞ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É ETL-–ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ S3 —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å–ª–æ—è–º –¥–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ Apache Airflow.

## üó∫Ô∏è Entity-Relationship Diagram
![erd1](./images/first_schema.png)
![erd2](./images/last_schema.png)

## üìà Graph
![dags](./images/dags.png)
![s3](./images/load_s3.png)
![dwh](./images/insert_dwh.png)
## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
~~~
.
‚îú‚îÄ‚îÄ dags                 # DAG.
‚îú       ‚îÄ‚îÄ lib           # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏.
‚îú       ‚îÄ‚îÄ sql           # SQL —Å–∫—Ä–∏–ø—Ç—ã.
‚îú‚îÄ‚îÄ data                 # –ö–∞—Ç–æ–ª–æ–≥ —Ö—Ä–∞–Ω–µ–Ω–∏—è csv —Ñ–∞–π–ª–æ–≤.
‚îú‚îÄ‚îÄ images/              # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
‚îú‚îÄ‚îÄ.dockerignore         # –§–∞–π–ª—ã, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ Docker-–æ–º.
‚îú‚îÄ‚îÄ.gitignore/           # –§–∞–π–ª—ã, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ Git-–æ–º.
‚îú‚îÄ‚îÄ docker-compose.yaml/ # –°–µ—Ä–≤–∏—Å—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞.
‚îú‚îÄ‚îÄ README.md/           # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ.
‚îî‚îÄ‚îÄ requirements.txt/    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.
~~~

## üîå –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã  
Airflow
~~~
Login: AirflowAdmin
Pass: airflow_pass
URL: http://localhost:3000/airflow
~~~
Vertica
~~~
–•–æ—Å—Ç: vertica.tgcloudenv.ru
–ë–î —Å—Ö–µ–º–∞: dwh
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: stv2025061611
–ü–∞—Ä–æ–ª—å: G1A4LjhBsbp7363
–ü–æ—Ä—Ç: 5433
~~~

## üî® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ docker-compose.yaml
~~~
docker compose up -d
~~~
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã –≤ Airflow  
~~~
Connection Id: vertica_conn
Connection Type: Vertica
Description: pass
Host: vertica.tgcloudenv.ru
Schema: dwh
Login: stv2025061611
Password: G1A4LjhBsbp7363
Port: 5433
Extra: {"autocommit": true, "tlsmode": "disable"}
~~~
4. –°–æ–∑–¥–∞–µ–º –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
~~~
AWS_ACCESS_KEY_ID: 
AWS_SECRET_ACCESS_KEY: 
bucket: sprint6
endpoint_url: https://storage.yandexcloud.net
service_name: s3
~~~
5. –ì–æ—Ç–æ–≤–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å DAG –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü –¥–∞–Ω–Ω—ã–º–∏  
–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è DAG:  
 **`init_db_dag`** - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.  
 **`load_s3`** - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –∏–∑ S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞.  
 **`load_stg`** - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ staging-–æ–±–ª–∞—Å—Ç—å.  
 **`insert_dwh_dag`** - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü core –∏ —Å–æ–∑–¥–∞–Ω–∏–µ VIEW.  

–ó–∞–ø—É—Å–∫–∞–π—Ç–µ DAG –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã ETL-–ø—Ä–æ—Ü–µ—Å—Å–∞.
