# AsmblDataWarehouse
![DWH](./images/DWH.jpg)
–ü—Ä–æ–µ–∫—Ç ProductionDashboard –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å, –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö.

### üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.  
- **Airflow** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è ETL –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.   
- **Odoo** - –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö.  
- **Python** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.  
- **SQL** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.  
- **PosgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.  
- **Apache Superset** - BI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.  
- **Docker-compose** - –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤.   

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ dags/                # DAG.
‚îú‚îÄ‚îÄ images/              # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
‚îú‚îÄ‚îÄ tmp_data/            # –•—Ä–∞–Ω–µ–Ω–∏–µ xlsx –∏ csv —Ñ–∞–π–ª–æ–≤.
‚îú‚îÄ‚îÄ.gitignore/           # –§–∞–π–ª—ã, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ Git-–æ–º.
‚îú‚îÄ‚îÄ docker-compose.yaml/ # –ü–ª–∞–≥–∏–Ω—ã Airflow.
‚îú‚îÄ‚îÄ download_dataset.py  # –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞.
‚îú‚îÄ‚îÄ README.md/           # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ.
‚îî‚îÄ‚îÄ  requirements.txt/   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.
```

### üî® –ù–∞—Å—Ç—Ä–æ–π–∫–∞
- –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
- –ü–æ–¥–Ω–∏–º–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã —Å –ø–æ–º–æ—â—é [docker-compose](docker-compose.yaml)
~~~
docker compose up
~~~
- –í –±—Ä–∞—É–∑–µ—Ä–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ http://localhost:8080
- –í–≤–æ–¥–∏–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å (airflow, airflow)
- –ù–∞—Å—Ç—Ä–∏–≤–∞–µ–º –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä.  
  Conn Id: postgres_dwh  
  Conn Type: postgres   
  Host: postgres_dwh    
  Port: 5432 
- –í –ø–∞–ø–∫–µ tmp_data –ª–µ–∂–∏—Ç [dataset](/tmp_data/raw_data%20‚Äî%20–∫–æ–ø–∏—è.xlsx)
- –ì–æ—Ç–æ–≤–æ, —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ DAG –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –Ω–∞–ø–æ–Ω—è—Ç—å—Å—è.
- –ß—Ç–æ –±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ postgres:15  
  POSTGRES_USER: admin  
  POSTGRES_PASSWORD: admin  
  POSTGRES_DB: dwh_db  
  ports: 5433:5432  
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Apache Superset  
**–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:**
~~~
docker exec -it asmbldatawarehouse-superset-1 superset fab create-admin \
            --username superset \
            --firstname Superset \
            --lastname Superset \
            --email admin@admin.com \
            --password superset
~~~
**–î–µ—Ç–∞–ª–∏:**    
`docker exec:` –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Docker.  
`-i` ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º, –ø–æ–∑–≤–æ–ª—è—é—â–µ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.  
`-t` ‚Äî –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Å–µ–≤–¥–æ—Ç–µ—Ä–º–∏–Ω–∞–ª–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–µ–≥–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–≤–æ–¥-–≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö.  
`asmbldatawarehouse-superset-1:` –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞.  
`superset:` –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º Apache Superset.  
`fab:` –§–∞–±—Ä–∏–∫–∞ –∫–æ–º–∞–Ω–¥, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–æ–ª—è–º–∏.  
`create-admin:` –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ —Ñ–∞–±—Ä–∏–∫–∏, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).  
**–§–ª–∞–≥–∏ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:**    
`--username superset:` –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.  
`--firstname Superset:` –ò–º—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.  
`--lastname Superset:` –§–∞–º–∏–ª–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.  
`--email admin@admin.com:` –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.  
`--password superset:` –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞. 

####  –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Apache Superset  
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ Superset. –û–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è, —á—Ç–æ –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –∫–æ–ª–æ–Ω–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —Å —Ç–µ–∫—É—â–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ Superset.
~~~
docker exec -it asmbldatawarehouse-superset-1 superset superset db upgrade
~~~

–î–∞–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –ø–µ—Ä–≤–∏—á–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Superset. –û–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (—Ä–æ–ª–∏, –≥—Ä—É–ø–ø—ã, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –ø—Ä–æ—á.) –∏ –≥–æ—Ç–æ–≤–∏—Ç —Å—Ä–µ–¥—É –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.  
~~~
docker exec -it asmbldatawarehouse-superset-1 superset superset init
~~~

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –î—Ä–∞–π–≤–µ—Ä –¥–ª—è SUPERSET –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ
~~~
pip install psycopg2-binary
~~~

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Apache Superset.

### üìö –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã ETL: 
![DAGS](./images/tasks.jpg)

  1Ô∏è‚É£–ó–∞–ø—É—Å–∫ [download_dataset](/download_dataset.py): –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–∞–π—Ç–∞.
  2Ô∏è‚É£–ó–∞–ø—É—Å–∫ [transform_file](dags/transform_file.py): –û—á–∏—Å—Ç–∫–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.    
  3Ô∏è‚É£–ó–∞–ø—É—Å–∫ [insert_stage](dags/insert_stage.py): –ó–∞–≥—Ä—É–∑–∫–∞ raw_data –≤ stage —Å–ª–æ–π.   
  4Ô∏è‚É£–ó–∞–ø—É—Å–∫ [insert_core](dags/insert_core.py): –ó–∞–≥—Ä—É–∑–∫–∞ –≤ core —Å–ª–æ–π.
  5Ô∏è‚É£–ó–∞–ø—É—Å–∫ [insert_data_mart](dags/insert_data_mart.py): –ó–∞–≥—Ä—É–∑–∫–∞ –≤ data_mart —Å–ª–æ–π.

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ—Ä—Ç—ã –∏ –¥–æ—Å—Ç—É–ø
- Airflow - `http://localhost:8080` | User: airflow, Pass: airflow |
- Conn_Id - Postgres_dwh | Ports `5433:5432` | User: admin, Pass: admin, Database: dwh_db |  
- Superset - `http://localhost:80` | User: superset, Pass: superset |

